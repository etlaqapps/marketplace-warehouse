# a Proposal of a modular system.

## Base System (Foundation).

### Feature 1 — Landing Page
| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC1.1 | Platform Overview | As a potential user, I want to view a landing page with platform information so that I can learn about the app and decide to sign up. | Given a visitor accesses the landing page<br>When they browse sections (hero, features, CTA)<br>Then feature overviews are displayed, and "Sign Up" button redirects to signup screen.<br>Edge: Mobile view → responsive stacking of cards.<br>Error: Page load failure → show fallback static text with retry button. |

### Feature 2 — Authentication
| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC2.1 | Signup Basic Info | As a new user, I want to enter basic details (email, phone, password, license/document) so that I can start creating an account. | Given a new user on signup step 1<br>When they submit valid details and upload document<br>Then form validates in real-time, and proceeds to OTP verification.<br>Edge: Missing fields → disabled "Next" button with highlighted errors.<br>Error: Duplicate email/phone → inline error "Already registered? Log in" with link. |
| UC2.2 | OTP Verification | As a new user, I want to verify email or phone via OTP so that my contact details are confirmed securely. | Given OTP sent during signup<br>When user enters correct 6-digit OTP (tabs for email/phone)<br>Then verification succeeds, proceeds to profile completion.<br>Edge: Resend OTP → new code sent after 60s cooldown.<br>Error: Invalid OTP (3 attempts) → lockout modal "Too many attempts. Wait 5 mins." with shake animation. |
| UC2.3 | Profile Completion | As a new user, I want to complete my profile (name, business type, address, avatar) so that my account is fully set up pending approval. | Given OTP verified<br>When user submits valid profile details<br>Then account is created, success modal shown, and admin notified for approval.<br>Edge: Optional fields skipped → no error, but reminder toast.<br>Error: Invalid data (e.g., short name) → error list at top, scroll to first issue. |
| UC2.4 | Post-Signup Confirmation | As a new user, I want a confirmation after signup so that I know the status and next steps. | Given profile submitted<br>When modal/page loads<br>Then displays "Account pending approval" with links to login/home.<br>Edge: Email notification sent → confirm in logs (system).<br>Error: None (static page). |
| UC2.5 | Login | As an existing user, I want to log in with email/phone and password so that I can access my dashboard securely. | Given a registered user on login screen<br>When correct credentials entered<br>Then user is authenticated and redirected to role-based dashboard.<br>Edge: "Forgot Password?" link → opens recovery modal.<br>Error: Invalid credentials (3 attempts) → show CAPTCHA and temporary lockout. |
| UC2.6 | Password Recovery | As an existing user, I want to recover my password via OTP so that I can regain access if forgotten. | Given "Forgot Password" clicked<br>When email/phone submitted, OTP verified, new password set<br>Then password is reset, success message shown, and redirect to login.<br>Edge: Step indicators for multi-step process.<br>Error: Invalid email/phone → "Not found" error; OTP fail → resend option. |

### Feature 3 — Authorization (RBAC)
| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC3.1 | Role-Based Dashboard Routing | As a user, I want automatic routing to my role-specific dashboard upon login so that I see relevant content immediately. | Given user logs in with a role<br>When URL/path and role checked<br>Then redirected to appropriate dashboard (e.g., user vs. admin).<br>Edge: Multi-role user → header dropdown to switch roles, confirms and reloads.<br>Error: Invalid/unauthorized role → 403 error page "Contact Admin" with logout. |
| UC3.2 | Define Roles | As an Admin, I want to create, edit, or delete roles with permissions so that access control reflects business needs. | Given admin on "Define Roles" tab<br>When they create/edit a role (name, description, inheritance, permissions matrix)<br>Then role is persisted, list refreshes, and success toast shown.<br>Edge: Inheritance selected → pre-fills permissions, overridable.<br>Error: Duplicate name → inline error "Name in use"; delete in use → modal "Unassign from users first." |
| UC3.3 | Permission Granularity | As an Admin, I want to set fine-grained permissions (entity/action level) so that least privilege is enforced. | Given role creation/edit modal open<br>When permissions toggled (e.g., Read/Write for Analytics)<br>Then matrix updates, and on save, UI/API blocks unauthorized actions (403).<br>Edge: Constraint checkbox (e.g., one role per system) → adds scoping dropdown.<br>Error: Conflict with inheritance → warning banner "Overriding inherited permissions?" |
| UC3.4 | Assign Roles | As an Admin, I want to assign roles to users or teams with scoping so that access is limited appropriately. | Given admin on "Assign Roles" tab<br>When users selected, role/scope chosen, and "Assign" clicked<br>Then assignments update, current roles column refreshes, toast "Assigned to X users."<br>Edge: Bulk select/unassign → confirm modal for changes.<br>Error: Constraint violation (e.g., one role per system) → toast "User already has role in this system - unassign first." |
| UC3.5 | Audit Role Changes | As a system, I want to log role/permission changes and assignments so that admins can review security events. | Given RBAC event occurs (create, assign, delete)<br>When event triggers<br>Then log entry stored with actor, timestamp, before/after state; visible in system analytics.<br>Edge: Export logs → CSV download.<br>Error: Log failure → alert admin via email (if notifications enabled). |

### Feature 4 — Analytics
| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC4.1 | User Analytics Dashboard | As a non-admin user, I want to view basic KPIs (e.g., balance, activity) so that I can track my performance. | Given user on analytics section<br>When data loads<br>Then KPI cards/charts shown (e.g., balance chart, activity list) with refresh/export buttons.<br>Edge: No data → guidance message "Add payments to see stats."<br>Error: Load failure → retry button with error toast. |
| UC4.2 | Admin System Analytics | As an Admin, I want full oversight analytics (multi-user KPIs, logs, alerts) so that I can monitor and resolve system issues. | Given admin on system analytics screen<br>When viewing data (charts, logs table)<br>Then all-user KPIs displayed, filters (user/role/date) applied, resolve button for errors.<br>Edge: Click log → details modal.<br>Error: Unauthorized access → 403 page. |

### Feature 5 — Basic Payment & Payout
| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC5.1 | Balance Check & Top-Up | As a user, I want to view and top up my balance via Moyasar so that I can maintain funds for operations. | Given user on payments section<br>When "Top Up" clicked, amount entered, Moyasar form submitted<br>Then payment processed, balance updated, success toast shown.<br>Edge: Low balance → warning banner "Top up to continue."<br>Error: Transaction rejected → error "Retry?" with log. |
| UC5.2 | Payout Handling | As a user (with permission), I want to initiate payouts via Moyasar so that I can withdraw funds on schedule. | Given payout cycle (e.g., manual trigger if allowed)<br>When amount/bank details entered in modal<br>Then payout scheduled/processed, logs updated.<br>Edge: Cycle info shown (e.g., next payout date).<br>Error: Insufficient balance → disabled button with tooltip; API fail → retry queue. |

### Feature 6 — Profile & Settings (Shared)
| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC6.1 | Profile Management | As a user, I want to view and edit my profile (name, email, phone, avatar, password) so that my details stay current. | Given user on profile screen<br>When edits saved<br>Then changes persisted, confirmation modal shown.<br>Edge: Pencil icons for edit mode.<br>Error: Invalid input → inline validation errors. |

### Feature 7 — Admin-Specific (User Approval & Oversight)
| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC7.1 | User Approval Queue | As an Admin, I want to review and approve/reject new users so that only valid accounts are activated. | Given admin on approval queue screen<br>When approve/reject clicked (view documents in modal)<br>Then status updated, email sent to user.<br>Edge: No pendings → empty state message.<br>Error: Invalid document → reject with reason modal. |
| UC7.2 | Admin Dashboard Access | As an Admin, I want an enhanced dashboard with admin tools so that I can oversee the system. | Given admin login<br>When dashboard loads<br>Then shows admin sidebar (e.g., User Management, Role Editor), overview KPIs.<br>Edge: Search bar for quick navigation.<br>Error: Non-admin access → hidden/403. |

### Feature 8 — General System Behaviors
| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC8.1 | Logout | As an authenticated user, I want to log out securely so that my session ends. | Given any authenticated screen<br>When logout clicked from profile icon<br>Then confirm modal shown, on yes redirects to landing page.<br>Edge: None.<br>Error: Session error → auto-logout with message. |
| UC8.2 | Error Pages | As a user, I want friendly error pages (404, 500, 403) so that issues are handled gracefully. | Given invalid access/load<br>When error occurs<br>Then shows appropriate page (e.g., 404: "Page not found" with home link).<br>Edge: None.<br>Error: None (fallback UI).

### Wireframes of the base system

<img width="2560" height="2752" alt="screen" src="https://github.com/user-attachments/assets/d46b79fe-e41f-4e26-b487-2143f208e8fc" />

<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/ea7900b7-40ef-42a7-bab7-c4b28ae2d97e" />
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/2cbeb1d4-caaf-46f8-9eda-683f50020014" />

<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/8f26045c-2da4-4b4c-a264-006794b21391" />
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/1a6ae1b0-4853-4ac1-8a47-a3fc1c36d2d4" />
<img width="2560" height="2378" alt="screen" src="https://github.com/user-attachments/assets/ecd304a7-4b8d-4435-adb5-d86738d7b5e8" />
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/b99e0ed7-cfad-4113-a676-424a72a35838" />
<img width="2560" height="1714" alt="screen" src="https://github.com/user-attachments/assets/928b308f-b6a0-43df-add5-e852efadfd17" />
<img width="2560" height="2174" alt="screen" src="https://github.com/user-attachments/assets/513dd022-3f50-4da8-a862-2702bdd3308c" />
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/7b5c27ba-20a3-4399-9560-b2649af69f60" />
<img width="2560" height="2084" alt="screen" src="https://github.com/user-attachments/assets/38a86e93-498d-4366-8300-2579176ffcee" />
<img width="2560" height="2214" alt="screen" src="https://github.com/user-attachments/assets/4622eaf4-9c03-43ce-ae06-d7a4d6d7970d" />

## Plugin 1 — Store & Product Management



| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC1.1 | Store Registration Form | As a Store Owner, I want to enter store details (name, food type, address, workers, license) so that my store can be onboarded and approved. | Given Store Owner on registration screen<br>When valid details submitted (e.g., name, dropdown for food type, address textarea, workers number input, license upload)<br>Then form validates, store profile saved pending approval, admin notified.<br>Edge: Optional workers field skipped → no error, defaults to 0.<br>Error: Invalid data (e.g., missing name) → inline errors, disabled submit; duplicate store name → "Store name already exists" toast. |
| UC1.2 | Store Approval Workflow | As an Admin, I want to review and approve/reject store registrations so that only compliant stores are activated. | Given pending store in approval queue<br>When admin views details (e.g., click row for modal with license preview)<br>Then approve activates store, sends email to owner; reject prompts reason modal, notifies owner.<br>Edge: No pendings → empty state "No stores awaiting approval."<br>Error: Invalid license (e.g., poor quality) → flag in modal, re-upload request sent to owner. |
| UC1.3 | Product Create/Upload Form | As a Store Owner, I want to create/upload product details (basic info, images, stock, SKU) so that products can be submitted for approval and inventory management. | Given Store Owner on product create screen (post-store approval)<br>When details entered (name/text, images drag-drop/multiple, stock number, SKU text with uniqueness check)<br>Then validates (e.g., image size <5MB), saves pending approval, syncs to inventory queue.<br>Edge: Multiple images → thumbnail previews with reorder/delete.<br>Error: Bad data (e.g., negative stock) → validation error; upload fail → "File type not supported (JPEG/PNG only)" message. |
| UC1.4 | Product Approval Workflow | As an Admin, I want to review and approve/reject new products so that only valid products are listed in inventory and marketplace. | Given pending product in queue<br>When admin reviews (modal with details, images carousel, stock/SKU info)<br>Then approve adds to live inventory, notifies owner; reject with reason, allows resubmit.<br>Edge: Bulk approve/reject → checkboxes for multiple selections.<br>Error: Duplicate SKU → auto-reject with "Duplicate detected" log. |
| UC1.5 | Product List & Read/View | As a Store Owner, I want to list and view my products with search/filter/sort/export so that I can manage large inventories efficiently. | Given Store Owner on products list screen<br>When searching (e.g., by name/SKU), filtering (e.g., by food type/low stock), sorting (e.g., by stock DESC)<br>Then displays paginated table (name, SKU, stock gauge, images thumbnail, actions), export button (CSV/PDF).<br>Edge: No products → empty state "No products yet - create one."<br>Error: Search fail (e.g., network) → retry button with warning. |
| UC1.6 | Product Update/Edit | As a Store Owner, I want to edit existing product details (info, images, stock) so that I can update inventory without re-uploading. | Given Store Owner selects product from list<br>When edits in modal/form (update name, add/remove images, adjust stock)<br>Then saves changes, triggers re-approval if major (e.g., name change), syncs to inventory.<br>Edge: Minor edits (e.g., stock only) → no approval needed.<br>Error: Invalid update (e.g., duplicate SKU) → inline error; concurrent edit → version conflict modal "Refresh and try again." |
| UC1.7 | Product Delete | As a Store Owner, I want to delete products (single or bulk) so that obsolete items are removed from inventory. | Given Store Owner on list screen<br>When selects product(s), clicks delete (confirm modal)<br>Then removes from DB, notifies warehouse if stocked, logs action.<br>Edge: Bulk delete → checkboxes, confirm with count "Delete X products?"<br>Error: Product in active order → block with error "Cannot delete - in use." |
| UC1.8 | Bulk Product Upload/Import | As a Store Owner, I want to bulk upload products via CSV so that I can add multiple items efficiently for enterprise-scale operations. | Given Store Owner on bulk upload screen<br>When uploads CSV (template download link, columns: name, SKU, stock, food type, image URLs)<br>Then parses, validates rows, submits for batch approval, shows progress bar/report (e.g., "X succeeded, Y failed").<br>Edge: Partial success → list errors per row (e.g., "Row 5: Invalid stock").<br>Error: Invalid CSV format → error toast "Malformed file - download template." |
| UC1.9 | Inventory Views & Updates | As a Store Owner, I want to view inventory updates, stock levels, and KPIs so that I can track product status without manual checks. | Given Store Owner on dashboard/inventory section<br>When data loads (real-time sync from warehouse)<br>Then displays table/cards (product name, SKU, stock level, updates list with timestamps), KPIs (e.g., low stock count, sales velocity chart).<br>Edge: Filter by status (e.g., pending approval) → dynamic table update.<br>Error: Sync failure → retry button, fallback to last known data with warning banner. |
| UC1.10 | System Inventory Sync & Rules | As a system, I want to sync product CRUD actions to live inventory with rules (e.g., SKU mapping, low stock thresholds) so that warehouse and marketplace are updated automatically. | Given product CRUD event (create/update/delete/approve)<br>When sync triggers (background job)<br>Then updates inventory DB, applies rules (e.g., map SKU, flag low stock), notifies supervisor for shelf assignment, logs event.<br>Edge: Manual trigger by admin → override button in queue.<br>Error: Sync conflict (e.g., stock mismatch) → admin alert, rollback with error log. |

## Wireframes of Marketplace

<img width="2560" height="2612" alt="screen" src="https://github.com/user-attachments/assets/6bc63de2-d595-4592-82e7-86cd89d8fcea" />
<img width="2644" height="1600" alt="screen" src="https://github.com/user-attachments/assets/48f14b32-8d35-448a-ba6a-17072d4795ac" />

<img width="2560" height="2632" alt="screen" src="https://github.com/user-attachments/assets/e091c622-8412-4191-9b62-64718fca4c50" />
<img width="2560" height="1754" alt="screen" src="https://github.com/user-attachments/assets/df08b3c8-1a9c-4e1a-aab7-5a0a25b6284a" />
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/c4cb594f-29d5-43dd-823d-064d3da37896" />

## Plugin: Warehouse Management

| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC2.1 | Staff Addition/Create Form | As a Warehouse Owner, I want to add supervisors or workers (name, email/phone, role assignment) so that team members can be onboarded with role constraints. | Given Warehouse Owner on staff add screen<br>When valid details submitted (name text, email/phone, role dropdown: supervisor/worker)<br>Then validates (e.g., one role per system), adds user, sends invitation email, syncs to RBAC.<br>Edge: Role constraint check → warning if violates (e.g., user already has role in another system).<br>Error: Duplicate email → "User exists - assign existing?" link; invalid data → inline errors, disabled submit. |
| UC2.2 | Staff List & Read/View | As a Warehouse Owner, I want to list and view staff with search/filter/sort/export so that I can manage large teams efficiently. | Given Warehouse Owner on staff list screen<br>When searching (e.g., by name/email), filtering (e.g., by role/active), sorting (e.g., by join date)<br>Then displays paginated table (name, role badge, email/phone, status, actions), export button (CSV/PDF).<br>Edge: No staff → empty state "No team members - add one."<br>Error: Load failure → retry button with warning. |
| UC2.3 | Staff Update/Edit | As a Warehouse Owner, I want to edit staff details (e.g., role switch, contact) so that changes can be made without re-adding. | Given Warehouse Owner selects staff from list<br>When edits in modal/form (update name, role with constraint check)<br>Then saves, notifies user if role changes, syncs to RBAC.<br>Edge: Role switch → confirm modal if affects access.<br>Error: Constraint violation → error "Cannot assign - violates one role per system"; concurrent edit → version conflict "Refresh." |
| UC2.4 | Staff Delete | As a Warehouse Owner, I want to delete staff (single or bulk) so that inactive members are removed. | Given Warehouse Owner on list screen<br>When selects staff(s), clicks delete (confirm modal)<br>Then removes from DB, revokes access, logs action.<br>Edge: Bulk delete → checkboxes, confirm with count "Delete X staff?"<br>Error: Active assignments (e.g., pending tasks) → block "Cannot delete - reassign tasks first." |
| UC2.5 | Bulk Staff Addition/Import | As a Warehouse Owner, I want to bulk add staff via CSV so that large teams can be onboarded efficiently. | Given Warehouse Owner on bulk add screen<br>When uploads CSV (template download, columns: name, email, role)<br>Then parses, validates rows, adds batch, shows report (e.g., "X added, Y failed").<br>Edge: Partial success → error list per row (e.g., "Row 3: Invalid email").<br>Error: Invalid format → "Malformed CSV - download template." |
| UC2.6 | Shelf Assignment (Manual/Auto) | As a Supervisor, I want to assign shelves to products on arrival (manual or auto) so that storage is optimized. | Given Supervisor on assignment screen (triggered by arrival)<br>When selects product, assigns shelf (dropdown or map click; auto-suggest toggle)<br>Then saves location, updates inventory, notifies worker for placement.<br>Edge: Auto mode → suggests based on rules (e.g., food type/size; future AI).<br>Error: Shelf full → error "Select another - capacity exceeded"; no shelves → "Add shelves first." |
| UC2.7 | QR Mapping for Store/Pick | As a Worker, I want to use QR map to store or pick products so that locations are accurately logged. | Given Worker on mobile/web map screen (scan or search product)<br>When scans QR/shelf, confirms action (store/pick)<br>Then logs movement, updates stock/location in real-time, shows success.<br>Edge: Map UI → interactive floorplan with zoom/pan, highlighted paths.<br>Error: Wrong QR → shake/vibrate "Invalid shelf - rescan"; offline → queue for sync. |
| UC2.8 | Inventory Management List & View | As a Supervisor, I want to view and manage live inventory with search/filter/sort/export so that I can oversee stock efficiently. | Given Supervisor on inventory screen<br>When searching (e.g., by product/SKU), filtering (e.g., low stock/shelf), sorting (e.g., by expiry)<br>Then displays table (product, shelf location link, stock, status, actions), export.<br>Edge: Integrate with map → click location → zooms to shelf.<br>Error: Sync delay → warning banner "Data may be stale - refresh." |
| UC2.9 | Warehouse Order Creation | As a Supervisor, I want to create warehouse orders from arrivals/marketplace so that picking/packing can begin. | Given arrival/order received<br>When creates order (select products, assign to worker)<br>Then generates order ID, updates status (Pending → Assigned), notifies worker.<br>Edge: Bulk from batch arrival → auto-populate.<br>Error: Insufficient stock → block "Adjust quantities." |
| UC2.10 | Picking & Packing Workflow | As a Worker, I want to pick and pack orders using QR validation so that fulfillment is accurate. | Given Worker on order screen<br>When scans product/shelf for pick, confirms pack (quantity check)<br>Then validates (e.g., packing-validation), updates status to Packed, logs.<br>Edge: Partial pick → save progress.<br>Error: Wrong item → error "Mismatch - rescan correct product." |
| UC2.11 | System Inventory Sync & Tracking | As a system, I want to sync inventory movements (assignments, picks) with shelf tracking so that real-time accuracy is maintained. | Given movement event (assign/store/pick)<br>When sync triggers<br>Then updates DB, applies rules (e.g., low stock alert), logs with timestamps.<br>Edge: Manual override by supervisor → audit log.<br>Error: Conflict (e.g., race condition) → rollback, alert admin. |

## Wireframes

<img width="2560" height="1846" alt="screen" src="https://github.com/user-attachments/assets/0602dee8-2466-41e9-b1b0-48e0a9f14f65" />
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/690cdd56-d6fb-40a4-8890-c027b08c7619" />
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/d1cceceb-3d08-4e1e-977e-538bbf7c7dd2" />
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/03eef8eb-c63e-4822-9d21-e4ca8e906d35" />
<img width="2560" height="2162" alt="screen" src="https://github.com/user-attachments/assets/1503c98e-9852-440d-b237-468012436f81" />
<img width="2560" height="1768" alt="screen" src="https://github.com/user-attachments/assets/c5c14922-e6d7-47ff-989b-bf97212540ae" />


## Plugin: Logistics Management

| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC3.1 | Pickup Scheduling Trigger | As a Supervisor, I want to trigger a pickup via Torod API when a store submits "Ready for Transfer" so that products are collected from stores efficiently. | Given a "Ready for Transfer" order from store<br>When supervisor triggers (select order, check balance)<br>Then API call to Torod schedules pickup, updates status to "Scheduled", notifies store owner.<br>Edge: Balance sufficient → proceed; low balance → prompt store to top-up.<br>Error: API unresponsive → fallback to manual mode, log error, alert admin. |
| UC3.2 | Balance Validation Check | As a system, I want to validate store balance before pickup trigger so that unpaid requests are blocked. | Given pickup request initiated<br>When balance checked against required (via base payment integration)<br>Then allows if sufficient, blocks otherwise with notification to store.<br>Edge: Prepay onboarding balance → auto-deduct.<br>Error: Balance API fail → retry logic, fallback to last known balance with warning. |
| UC3.3 | Manual Fallback Entry | As a Supervisor, I want to manually enter pickup details if API fails so that logistics continue without interruption. | Given API failure flagged<br>When supervisor enters manual form (store address, products, date/time)<br>Then saves as manual order, assigns to carrier, notifies parties.<br>Edge: Override validation → allow with admin approval.<br>Error: Duplicate manual entry → de-dupe check "Order already exists." |
| UC3.4 | Logistics Order List & View | As a Supervisor/Store Owner, I want to list and view logistics orders with search/filter/sort/export/tracking so that I can monitor shipments efficiently. | Given user on orders list screen<br>When searching (e.g., by order ID/store), filtering (e.g., status: Scheduled/In Transit/Delivered), sorting (e.g., by date DESC)<br>Then displays paginated table (ID, store, status badge, tracking link, actions), export (CSV/PDF), real-time tracking updates.<br>Edge: No orders → empty state "No logistics yet - schedule a pickup."<br>Error: Tracking fail → retry button, fallback to static status. |
| UC3.5 | Logistics Order Update/Edit | As a Supervisor, I want to edit order details (e.g., reschedule, change carrier) so that adjustments can be made for delays. | Given order selected from list<br>When edits in modal (update date, carrier dropdown, notes)<br>Then saves, re-triggers API if needed, notifies affected parties.<br>Edge: Status-dependent edits (e.g., can't edit Delivered).<br>Error: Invalid change (e.g., past date) → inline error; conflict → "Order updated by another - refresh." |
| UC3.6 | Logistics Order Delete/Cancel | As a Supervisor, I want to cancel orders (single or bulk) so that unnecessary pickups are stopped. | Given order(s) selected<br>When cancels (confirm modal with reason)<br>Then updates status to Canceled, refunds balance if deducted, logs.<br>Edge: Bulk cancel → checkboxes, confirm count.<br>Error: In-progress order → block "Cannot cancel - contact carrier." |
| UC3.7 | Bulk Pickup Scheduling | As a Supervisor, I want to bulk schedule pickups for multiple stores so that enterprise-scale operations are efficient. | Given bulk screen (e.g., select multiple "Ready" orders or CSV upload)<br>When submits batch (with balance checks)<br>Then triggers API for each, shows progress/report (e.g., "X scheduled, Y failed").<br>Edge: Partial success → error list per order.<br>Error: Batch too large → throttle "Limit 50 - split batches." |
| UC3.8 | Auto-Routing & Carrier Selection | As a system, I want to auto-route shipments to optimal carriers (e.g., Torod default, fallbacks) based on rules so that cost and latency are minimized. | Given order ready for routing<br>When auto-routes (rules: distance, cost, availability)<br>Then assigns carrier, generates label, updates tracking.<br>Edge: Manual override → supervisor selects from dropdown.<br>Error: No carriers available → alert "Add integrations," fallback manual. |
| UC3.9 | Label Generation & Printing | As a Supervisor, I want to generate and print shipping labels so that packages are prepared for carriers. | Given routed order<br>When generates label (button on order view)<br>Then creates PDF (with barcode, addresses, tracking #), offers print/download.<br>Edge: Custom formats per carrier.<br>Error: Generation fail → retry, log "API error." |
| UC3.10 | Real-Time Tracking Updates | As a Store Owner/Supervisor, I want real-time tracking for shipments so that status is visible without manual checks. | Given order in view/list<br>When updates from carrier API (e.g., In Transit → Delivered)<br>Then refreshes UI (websocket), notifies users, logs history.<br>Edge: Timeline view → steps (Scheduled > Picked > Delivered).<br>Error: API delay → "Tracking delayed - check later" banner. |
| UC3.11 | System Integration & Fallback | As a system, I want to integrate with Torod/carriers for automation with fallbacks so that reliability is ensured. | Given API call (pickup/route/track)<br>When succeeds → processes; fails → switches to manual, retries queue.<br>Edge: Configurable retries (e.g., 3 attempts).<br>Error: Persistent fail → admin alert, log details. |

## Wireframes
<img width="2560" height="1786" alt="screen" src="https://github.com/user-attachments/assets/bd0bfbec-4e5b-48f9-b111-e3581a5a1e12" />
<img width="2560" height="2488" alt="screen" src="https://github.com/user-attachments/assets/f65b7a55-d7f2-4104-a9c9-edae03104f08" />
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/18c3a8c6-f950-4229-8dd0-e8239c7f930e" />
<img width="2560" height="2952" alt="screen" src="https://github.com/user-attachments/assets/be9d8439-5da0-4805-bda0-29f9d36249c4" />
<img width="2560" height="2952" alt="screen" src="https://github.com/user-attachments/assets/f7521412-457f-4ad5-94a2-ea20aab8e41a" />
<img width="2560" height="2398" alt="screen" src="https://github.com/user-attachments/assets/a319065b-b9c1-4826-bd71-a274b9c532cc" />
<img width="2560" height="2420" alt="screen" src="https://github.com/user-attachments/assets/6c28e383-8f4d-4b68-9e1e-82913ac5d0e8" />
<img width="2560" height="2292" alt="screen" src="https://github.com/user-attachments/assets/944b38e0-4275-42e2-997a-65e12cf6f782" />

## Multi-Invoice Generation & Billing


| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC5.1 | Multi-Invoice Generation per Order | As an Accountant, I want automated multi-invoice generation (warehouse, store, marketplace, platform copies) on order creation so that parties receive accurate billing. | Given order created (from POS/logistics)<br>When generation triggers<br>Then splits invoice by party (e.g., warehouse: storage fees; store: product cost), generates PDFs, stores copies, notifies parties.<br>Edge: Custom splits → configurable percentages.<br>Error: Split logic fail → manual override modal, log "Recompute required." |
| UC5.2 | VAT Handling & Categorization | As an Accountant, I want VAT applied based on store category so that invoices comply with regulations. | Given invoice generation<br>When category checked (e.g., Family Product: No VAT; VAT-compliant: 15%)<br>Then applies rate, adds audit trail, tags invoice.<br>Edge: Category change → retroactive re-calc for open invoices.<br>Error: Undetermined category → prompt "Categorize store first" with link. |
| UC5.3 | Invoice List & View | As an Accountant/Store Owner, I want to list and view invoices with search/filter/sort/export/previews so that I can manage billing efficiently. | Given user on invoices list screen<br>When searching (e.g., by order ID/party), filtering (e.g., status: Generated/Paid, VAT type), sorting (e.g., date DESC)<br>Then displays paginated table (ID, order link, parties summary, VAT total, status, actions), export (CSV/PDF), preview button.<br>Edge: Multi-party view → expandable rows for splits.<br>Error: Load fail → retry, fallback to cached. |
| UC5.4 | Invoice Update/Edit | As an Accountant, I want to edit invoice details (e.g., splits, VAT re-calc) so that corrections can be made for disputes. | Given invoice selected<br>When edits (adjust splits, re-categorize VAT, add notes)<br>Then re-generates, syncs to QuickBooks, notifies parties.<br>Edge: Locked post-payment → view-only.<br>Error: Invalid split (e.g., over 100%) → inline error; concurrent edit → "Refresh changes." |
| UC5.5 | Invoice Delete/Void | As an Accountant, I want to void invoices (single or bulk) so that errors are reversed. | Given invoice(s) selected<br>When voids (confirm modal with reason)<br>Then marks as Voided, reverses splits/inventory if applicable, logs.<br>Edge: Bulk void → checkboxes, confirm count.<br>Error: Paid invoice → block "Cannot void - issue credit note." |
| UC5.6 | Bulk Invoice Generation | As an Accountant, I want to bulk generate invoices for multiple orders so that periodic billing is efficient. | Given bulk screen (select orders or by cycle)<br>When generates (auto-split/VAT)<br>Then processes batch, shows report (e.g., "X generated, Y errors").<br>Edge: Cycle-based → auto-run on schedule (e.g., monthly).<br>Error: Batch fail → partial, error list per invoice. |
| UC5.7 | Billing Cycles Management | As an Accountant, I want configurable billing cycles (e.g., weekly/monthly) with automations so that recurring invoices are handled. | Given cycle setup (e.g., Monday/Thursday from Moyasar)<br>When cycle runs<br>Then aggregates orders, generates invoices, deducts from balance.<br>Edge: Custom intervals → calendar picker.<br>Error: Overdue → alert "Process manually." |
| UC5.8 | Payment Gateway Integration | As a system, I want integration with Moyasar for invoice payments so that collections are automated. | Given invoice generated<br>When payment link sent (via email/portal)<br>Then processes via Moyasar, updates status to Paid, syncs balance.<br>Edge: Partial payment → split remaining.<br>Error: Gateway fail → retry queue, notify "Payment pending." |
| UC5.9 | QuickBooks Sync | As an Accountant, I want to push invoice records to QuickBooks so that accounting is unified. | Given invoice ready (generated/paid)<br>When sync triggers (manual or auto)<br>Then pushes to QuickBooks (e.g., as journal entries), reconciles, logs status.<br>Edge: Bulk sync → select date range.<br>Error: Sync fail → retry, alert "Reconcile manually." |
| UC5.10 | Invoice Splitting Logic | As a system, I want automated splitting based on roles/parties so that multi-party billing is accurate. | Given order with parties (warehouse/store/marketplace/platform)<br>When splits<br>Then allocates amounts (e.g., platform: fee %), applies VAT per category, generates copies.<br>Edge: Custom rules → admin-configurable.<br>Error: Misrouting → auto-re-route based on role map. |
| UC5.11 | Audit & Compliance Trails | As an Admin, I want audit logs for invoices (generation, edits, syncs) so that disputes/VAT audits are resolvable. | Given invoice event (generate/edit/sync)<br>When logs<br>Then stores with timestamps, actors, before/after, exportable for 90 days.<br>Edge: VAT disputes → filter by category.<br>Error: Log fail → alert, fallback local storage. |

## Wireframes
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/224e609d-42c6-4d82-87e4-a3b87dfafa43" />
<img width="256<img width="2560" height="1652" alt="screen" src="https://github.com/user-attachments/assets/462bfd0e-599d-45be-8197-39f370e7fcab" />
0" height="2434" alt="screen" src="https://github.com/user-attachments/assets/c6ca4ad8-a75e-47e4-bcb7-93847e6bca59" />
<img width="2560" height="1728" alt="screen" src="https://github.com/user-attachments/assets/e218fe11-19fb-4970-826f-2bb696f689da" />
<img width="2560" height="1722" alt="screen" src="https://github.com/user-attachments/assets/ad99082f-7d9c-4c20-a96b-43b8b58cff77" />

<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/5fafd9c5-4ca1-4e1e-8475-4c9e6744111b" />


## Plugin: Marketplace Management


| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC6.1 | Store Listing Sync | As a Supervisor, I want to sync store pages to Hungerstation via API so that stores are listed and visible on the marketplace. | Given approved store (from store plugin)<br>When sync triggers (manual or auto)<br>Then API pushes store details (name, address, products), updates status to "Listed", notifies owner.<br>Edge: Partial sync (e.g., new products) → queue for batch.<br>Error: API fail → retry queue (3 attempts), fallback manual. |
| UC6.2 | Product Listing Sync | As a Supervisor, I want to sync products to marketplace listings (e.g., Hungerstation/Amazon) so that inventory is reflected accurately. | Given approved products (from product plugin)<br>When sync runs (real-time or scheduled)<br>Then pushes details (name, price, images, stock via API), handles SKU mapping.<br>Edge: Multi-marketplace → select targets (Hungerstation/Amazon).<br>Error: Stock mismatch → alert "Resolve inventory first." |
| UC6.3 | Marketplace Listing List & View | As a Supervisor/Store Owner, I want to list and view listings with search/filter/sort/export/status so that I can manage multi-channel presence efficiently. | Given user on listings screen<br>When searching (e.g., by store/product), filtering (e.g., marketplace: Hungerstation/Amazon, status: Active/Syncing), sorting (e.g., by last sync DESC)<br>Then displays paginated table (Store/Product Name, Marketplace badge, Status, Sync Date, Actions), export (CSV/PDF).<br>Edge: Multi-channel view → grouped by marketplace.<br>Error: Load fail → retry, fallback cached. |
| UC6.4 | Listing Update/Edit | As a Supervisor, I want to edit listings (e.g., update prices, deactivate) so that changes propagate to marketplaces. | Given listing selected<br>When edits (update details, re-sync button)<br>Then saves, triggers API push, updates status.<br>Edge: Bulk edit → multi-select for common changes.<br>Error: Invalid update (e.g., negative price) → inline error; API reject → "Retry sync." |
| UC6.5 | Listing Delete/Deactivate | As a Supervisor, I want to deactivate listings (single or bulk) so that outdated items are removed from marketplaces. | Given listing(s) selected<br>When deactivates (confirm modal)<br>Then calls API to delist, updates status to Inactive, logs.<br>Edge: Bulk deactivate → checkboxes, confirm count.<br>Error: Active orders → block "Resolve orders first." |
| UC6.6 | Bulk Listing Sync | As a Supervisor, I want to bulk sync listings/products to marketplaces so that large catalogs are updated efficiently. | Given bulk screen (select stores/products or full catalog)<br>When syncs (with retry logic)<br>Then processes batch via API, shows report (e.g., "X synced, Y failed").<br>Edge: Scheduled bulk → cron job.<br>Error: Partial fail → error list per item. |
| UC6.7 | Order Aggregation from Marketplace | As a system, I want to aggregate orders from marketplaces (e.g., Hungerstation/Amazon) so that they are consolidated with POS/logistics without duplicates. | Given new order from marketplace API<br>When aggregates (match by timestamp/product/customer)<br>Then creates consolidated order, validates lifecycle (Pending), de-dupes.<br>Edge: Multi-source → merge into one record.<br>Error: Duplicate → skip/log "Already processed." |
| UC6.8 | Marketplace Order List & View | As a Supervisor/Store Owner, I want to list and view aggregated marketplace orders with search/filter/sort/export so that I can process them efficiently. | Given user on orders screen (marketplace tab)<br>When searching (e.g., by ID/customer), filtering (e.g., marketplace/source, status), sorting (e.g., by date)<br>Then displays table (ID, Marketplace badge, Customer, Items, Status, Actions), export.<br>Edge: Consolidated → source indicators.<br>Error: Sync delay → warning banner. |
| UC6.9 | Manual Order Entry Fallback | As a Supervisor, I want to manually enter marketplace orders if API fails so that fulfillment continues. | Given API failure<br>When enters form (customer details, products, marketplace source)<br>Then saves as manual, aggregates if matching, notifies.<br>Edge: Tie to existing listing → auto-populate products.<br>Error: Invalid data → validation "Complete all fields." |
| UC6.10 | Multi-Marketplace API Connector | As a system, I want connectors for multiple marketplaces (Hungerstation, Amazon) with retries so that syncs are resilient. | Given sync/order pull event<br>When calls API (Hungerstation primary, Amazon fallback)<br>Then handles responses, retries on fail, logs.<br>Edge: Configurable endpoints → admin setup.<br>Error: All fails → manual mode, alert. |
| UC6.11 | Sync & Order Status Management | As a Supervisor, I want to manage sync/order status (e.g., retry, monitor) so that issues are resolved quickly. | Given status flagged (e.g., Failed Sync)<br>When monitors/retries (dashboard with metrics)<br>Then updates status, re-syncs, exports logs.<br>Edge: Real-time metrics → websocket updates.<br>Error: Persistent issue → escalate to admin. |

## Wireframes
<img width="2560" height="2138" alt="screen" src="https://github.com/user-attachments/assets/bf6a7593-8ad7-4846-8147-9b83a1476f06" />
<img width="2560" height="1612" alt="screen" src="https://github.com/user-attachments/assets/4bc9ac42-9292-41e5-9a75-1f78df9fec45" />
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/590e1b9d-5c16-41a2-b5f0-3818f6d1c358" />
<img width="2560" height="1916" alt="screen" src="https://github.com/user-attachments/assets/753ff07c-8857-459c-bee2-7debe03e39d7" />
<img width="2560" height="1818" alt="screen" src="https://github.com/user-attachments/assets/afc2535f-160f-47cf-93b5-c3dad3d5e2bf" />
<img width="2560" height="2054" alt="screen" src="https://github.com/user-attachments/assets/49b29405-abaf-4127-b599-2bdef014d929" />
<img width="2560" height="3326" alt="screen" src="https://github.com/user-attachments/assets/68320331-b471-418a-9494-433614aa912f" />

## Plugin: Payout Handling & Payment

| ID | Use Case | User Story | Acceptance Criteria |
|----|----------|------------|---------------------|
| UC7.1 | Prepay Balance Top-Up | As a Store Owner, I want to top up prepay balance via Moyasar so that I can maintain funds for onboarding/deliveries. | Given Store Owner on top-up screen<br>When amount entered, Moyasar form submitted (card/wallet)<br>Then processes payment, adds to balance, notifies accountant.<br>Edge: Minimum top-up (e.g., 100 SAR) → validation.<br>Error: Transaction rejected → error "Retry?" with log. |
| UC7.2 | Balance Validation & Enforcement | As a system, I want to validate and deduct from prepay balance for services (e.g., pickups/invoices) so that unpaid actions are blocked. | Given service request (e.g., pickup from logistics)<br>When balance checked/deducted<br>Then allows if sufficient, blocks/prompts top-up otherwise.<br>Edge: Auto-deduct for cycles → batch process.<br>Error: Insufficient → notify "Top up required," log. |
| UC7.3 | Transaction List & View | As an Accountant/Store Owner, I want to list and view transactions (payments/payouts) with search/filter/sort/export/history so that I can track finances efficiently. | Given user on transactions screen<br>When searching (e.g., by ID/store), filtering (e.g., type: Payment/Payout, status: Pending/Completed), sorting (e.g., date DESC)<br>Then displays paginated table (ID, Type badge, Amount, Store, Status, Date, Actions), export (CSV/PDF), history modal.<br>Edge: Consolidated view → group by cycle.<br>Error: Load fail → retry, fallback cached. |
| UC7.4 | Transaction Update/Edit | As an Accountant, I want to edit transaction details (e.g., adjust amount, status) so that corrections can be made for errors. | Given transaction selected<br>When edits (amount, notes, status transition)<br>Then saves, re-syncs Moyasar if needed, notifies parties.<br>Edge: Post-completion → view-only.<br>Error: Invalid amount → inline "Positive value"; concurrent → "Refresh." |
| UC7.5 | Transaction Delete/Void | As an Accountant, I want to void transactions (single or bulk) so that invalid payments are reversed. | Given transaction(s) selected<br>When voids (confirm modal with reason)<br>Then marks as Voided, refunds via Moyasar, updates balance, logs.<br>Edge: Bulk void → checkboxes, confirm count.<br>Error: Completed payout → block "Cannot void - issue reversal." |
| UC7.6 | Bulk Payout Processing | As an Accountant, I want to bulk process payouts (e.g., for multiple stores) so that cycles are handled efficiently. | Given bulk screen (select stores/transactions or by cycle)<br>When processes (via Moyasar, multi-bank)<br>Then batches API calls, shows report (e.g., "X paid, Y failed").<br>Edge: Partial success → error list per store.<br>Error: Batch fail → rollback partial, alert. |
| UC7.7 | Payout Cycle Management | As an Accountant, I want configurable payout cycles (e.g., Monday/Thursday) with automations so that scheduled disbursements are reliable. | Given cycle setup (e.g., via Moyasar schedule)<br>When cycle runs<br>Then aggregates eligible transactions, processes payouts (Al Rajhi/SNB/STC Pay), deducts fees.<br>Edge: Custom banks → dropdown per store.<br>Error: Overdue → manual run option. |
| UC7.8 | Moyasar Payment Gateway Integration | As a system, I want integration with Moyasar for top-ups/payouts so that transactions are secure and automated. | Given payment/payout initiated<br>When calls Moyasar API (e.g., for Al Rajhi transfer)<br>Then processes, updates status/balance, handles callbacks.<br>Edge: Multi-method (STC Pay fallback) → user select.<br>Error: API fail → retry queue (3x), notify "Pending review." |
| UC7.9 | Multi-Bank Payout Support | As an Accountant, I want to support multiple banks (Al Rajhi, SNB, STC Pay) for payouts so that stores receive funds flexibly. | Given payout setup<br>When selects bank (per store config)<br>Then routes via Moyasar to bank, confirms transfer.<br>Edge: Bulk with mixed banks → group by type.<br>Error: Bank unavailable → fallback "Choose alternative." |
| UC7.10 | Balance History & Reporting | As a Store Owner, I want to view balance history and reports so that I can track prepay usage. | Given history screen<br>When views (charts: inflows/outflows, filters by date/type)<br>Then displays timeline, exportable reports.<br>Edge: Projected balance → simple forecast.<br>Error: Data gap → warning "Sync incomplete." |
| UC7.11 | Audit & Compliance for Transactions | As an Admin, I want audit logs for payments/payouts (triggers, edits, syncs) so that financial audits are supported. | Given transaction event<br>When logs<br>Then stores with timestamps, actors, before/after, exportable for compliance.<br>Edge: Cycle audits → filter by run.<br>Error: Log fail → alert, local backup. |

## Wireframes
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/a4ff4665-3ba5-4ea7-8753-793517ffe2fe" />
<img width="2560" height="2110" alt="screen" src="https://github.com/user-attachments/assets/e544e886-ea3f-45eb-93f1-ebddeddf9ba4" />
<img width="2560" height="2112" alt="screen" src="https://github.com/user-attachments/assets/7163890e-9b70-470a-86be-b062bc60dfad" />
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/e81bae80-4eb0-4e52-a9ba-e6e331456b4e" />
<img width="2530" height="3780" alt="screen" src="https://github.com/user-attachments/assets/54b900cd-cd98-4383-8ae2-9649d27fa610" />
<img width="2560" height="1996" alt="screen" src="https://github.com/user-attachments/assets/070ea162-e679-44e6-b1b3-35ea4bf44e32" />
<img width="2560" height="1600" alt="screen" src="https://github.com/user-attachments/assets/e6f6e4d0-fec9-44df-96e8-56d4fe1e61ae" />
